<mat-card class="participants-card">
  <mat-card-header>
    <mat-card-title id="participants-title">
      <fa-icon [icon]="faUser" aria-hidden="true"></fa-icon>
      Participants
    </mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <!-- User join notification with aria-live for screen readers -->
    <div *ngIf="wsService.newUserJoined()"
         class="user-joined-notification"
         role="status"
         aria-live="polite">
      <fa-icon [icon]="faUserPlus" aria-hidden="true"></fa-icon>
      <span>{{ wsService.recentJoinedUser() }} has joined the session</span>
    </div>

    <!-- Participants table with proper semantics -->
    <div class="point-list" role="table" aria-labelledby="participants-title">
      <!-- Table header -->
      <div class="user-info user-info-header" role="row">
        <div class="player-name" role="columnheader">
          <h3>Player</h3>
        </div>
        <div class="status-indicator" role="columnheader">
          <h3>Status</h3>
        </div>
        <div class="point-value" role="columnheader">
          <h3>Points</h3>
        </div>
      </div>

      <!-- Table rows -->
      <ng-container *ngFor="let userName of stateService.userNames()">
        <div class="user-info"
             *ngIf="wsService.pointValues()[userName] !== 'disconnect'"
             role="row"
             [attr.aria-current]="userName == currentUserName ? 'true' : null"
             [ngClass]="{'current-user': userName == currentUserName}">
          <div class="player-name" role="cell">
            <span>{{userName}}</span>
            <fa-icon *ngIf="userName == currentUserName"
                     [icon]="faUserCircle"
                     aria-label="Current user"
                     title="You">
            </fa-icon>
            <span *ngIf="userName == currentUserName" class="sr-only">(You)</span>
          </div>
          <div class="status-indicator" role="cell">
            <span class="status-dot"
              [ngClass]="{
                'status-online': wsService.userActivity()[userName]?.status === 'online',
                'status-away': wsService.userActivity()[userName]?.status === 'away',
                'status-offline': wsService.userActivity()[userName]?.status === 'offline' || !wsService.userActivity()[userName]
              }"
              role="img"
              [attr.aria-label]="(wsService.userActivity()[userName]?.status || 'offline') + ' status indicator'">
            </span>
            <span class="status-text">{{ wsService.userActivity()[userName]?.status || 'offline' }}</span>
          </div>
          <div class="point-value" role="cell">
            <span *ngIf="stateService.showValues()"
                  class="vote-value"
                  [attr.aria-label]="'Vote: ' + wsService.pointValues()[userName]">
              {{wsService.pointValues()[userName]}}
            </span>
            <div *ngIf="!stateService.showValues()" class="vote-status">
              <fa-icon
                [icon]="wsService.pointValues()[userName] ? faCheckCircle : faCircle"
                [ngClass]="{
                  'has-voted': wsService.pointValues()[userName],
                  'no-vote': !wsService.pointValues()[userName]
                }"
                aria-hidden="true">
              </fa-icon>
              <span>{{ wsService.pointValues()[userName] ? 'Voted' : 'Not voted' }}</span>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </mat-card-content>

  <mat-card-footer class="card-footer">
    <div class="help-text" role="note">
      <fa-icon [icon]="faQuestionCircle" aria-hidden="true"></fa-icon>
      <span>If you experience issues, refresh the browser or
        <a href="https://github.com/charlesabarnes/pointing-poker"
           target="_blank"
           rel="noopener noreferrer"
           aria-label="Report issues on GitHub (opens in new tab)">
          report it on GitHub
        </a>
      </span>
    </div>
  </mat-card-footer>
</mat-card>
